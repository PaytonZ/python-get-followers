'''
Initializer for autogenerated GUItest.property

v0.8 -- 10/07/2014 - GUI with listeners
v0.9 -- 10/07/2014 - GUI more funcionality (load clients in a list)
v0.10 -- 11/07/2014 - Helper for file management
v0.11 -- 11/07/2014 - Loading followers on tableView
v0.16 -- 30/07/2014 - Now delete client is working and more info in the table VIew
'''

from GuiGenerated import Ui_MainWindow
from PySide import QtCore, QtGui
import sys
import json
from helpers import FileHelper
import getFollowers
import accountManager
import string
from PySide.QtCore import QObject, SIGNAL, SLOT


oldData = { 'twitter' : '',
		 	'facebook' : '',
		 	'linkedin' : '',
		 	'googleplus' : '',
		 	'pinterest' : '',
		 	'youtube' : ''
		}

dicCk = {}

dicLt = {}

'''
CLIENT AREA LISTENERS
'''
def listenerClientName(textValue):
	if textValue != "":
		mySW.ui.saveBt.setEnabled(True)
		mySW.ui.pinterestText.setEnabled(True)
		mySW.ui.googleText.setEnabled(True)
		mySW.ui.facebookText.setEnabled(True)
		mySW.ui.linkedinText.setEnabled(True)
		mySW.ui.youtubeText.setEnabled(True)
		mySW.ui.twitterText.setEnabled(True)
	else:
		mySW.ui.saveBt.setEnabled(False)
		mySW.ui.pinterestText.setEnabled(False)
		mySW.ui.pinterestText.clear()
		mySW.ui.googleText.setEnabled(False)
		mySW.ui.googleText.clear()
		mySW.ui.facebookText.setEnabled(False)
		mySW.ui.facebookText.clear()
		mySW.ui.linkedinText.setEnabled(False)
		mySW.ui.linkedinText.clear()
		mySW.ui.youtubeText.setEnabled(False)
		mySW.ui.youtubeText.clear()
		mySW.ui.twitterText.setEnabled(False)
		mySW.ui.twitterText.clear()

def listenerSaveButton():

	clientName = mySW.ui.clientNameText.text()

	accounts = [ 'pinterest:'+mySW.ui.pinterestText.text(), 'googleplus:'+mySW.ui.googleText.text() , 'facebook:'+mySW.ui.facebookText.text(), 'linkedin:'+mySW.ui.linkedinText.text(), 'youtube:'+mySW.ui.youtubeText.text(), 'twitter:'+mySW.ui.twitterText.text() ]

	if clientName:
		accountManager.create_account_group(clientName, accounts, False)

	loadClientList();

'''
SOCIAL AREA LISTENERS
'''
def listenerCheckBoxes():
	if mySW.ui.twitterCk.isChecked() or mySW.ui.googleCk.isChecked() or mySW.ui.facebookCk.isChecked() or mySW.ui.pinterestCk.isChecked() or mySW.ui.youtubeCk.isChecked() or mySW.ui.linkedinCk.isChecked():
		mySW.ui.removeBt.setEnabled(True)
	else:
		mySW.ui.removeBt.setEnabled(False)

def listenerRemoveAccounts():

	item = mySW.ui.clientListWidget.currentItem()
	name = item.text()
	accounts = []

	if mySW.ui.twitterCk.isChecked():
		accounts.append('twitter')
	if mySW.ui.googleCk.isChecked():
		accounts.append('googleplus')
	if mySW.ui.facebookCk.isChecked():
		accounts.append('facebook')
	if mySW.ui.pinterestCk.isChecked():
		accounts.append('pinterest')
	if mySW.ui.youtubeCk.isChecked():
		accounts.append('youtube')
	if mySW.ui.linkedinCk.isChecked():
		accounts.append('linkedin')

	for account in accounts:
		accountManager.delete_account(name, account)

		dicCk[account].toggle()
		dicLt[account].clear()


def listenerEditInfo():

	if mySW.ui.googleText_2.isEnabled() and mySW.ui.facebookText_2.isEnabled() and mySW.ui.pinterestText_2.isEnabled() and mySW.ui.youtubeText_2.isEnabled() and mySW.ui.twitterText_2.isEnabled() and mySW.ui.linkedinText_2.isEnabled():
		
		mySW.ui.editBt.setText('Edit info')

		mySW.ui.googleText_2.setEnabled(False)
		mySW.ui.facebookText_2.setEnabled(False)
		mySW.ui.pinterestText_2.setEnabled(False)
		mySW.ui.youtubeText_2.setEnabled(False)
		mySW.ui.twitterText_2.setEnabled(False)
		mySW.ui.linkedinText_2.setEnabled(False)

		for account in oldData.keys():

			item = mySW.ui.clientListWidget.currentItem()
			name = item.text()

			dataAccount = dicLt[account].text()

			accountManager.add_account(name, account, dataAccount)
	else:
		mySW.ui.editBt.setText('Save edited info')

		mySW.ui.googleText_2.setEnabled(True)
		mySW.ui.facebookText_2.setEnabled(True)
		mySW.ui.pinterestText_2.setEnabled(True)
		mySW.ui.youtubeText_2.setEnabled(True)
		mySW.ui.twitterText_2.setEnabled(True)
		mySW.ui.linkedinText_2.setEnabled(True)

		oldData['twitter'] = mySW.ui.twitterText_2.text()
		oldData['facebook'] = mySW.ui.facebookText_2.text()
		oldData['linkedin'] = mySW.ui.linkedinText_2.text()
		oldData['googleplus'] = mySW.ui.googleText_2.text()
		oldData['pinterest'] = mySW.ui.pinterestText_2.text()
		oldData['youtube'] = mySW.ui.youtubeText_2.text()

def listenerOnClientClicked(item):

	if item:

		data = FileHelper().openReadOnlyJSONFileASObject('data.txt')

		clientSelected = item.text()

		for client in data['clients']:

			if client['name'] == clientSelected:
				accounts = client['accounts']

				mySW.ui.twitterText_2.clear()
				mySW.ui.youtubeText_2.clear()
				mySW.ui.googleText_2.clear()
				mySW.ui.pinterestText_2.clear()
				mySW.ui.facebookText_2.clear()
				mySW.ui.linkedinText_2.clear()

				if len(accounts) > 0:
					for account in accounts:

						accountName = account.split(':')[0]
						data = account.split(':')[1]

						if accountName == 'twitter':
							mySW.ui.twitterText_2.setText(data)
						elif accountName == 'youtube':
							mySW.ui.youtubeText_2.setText(data)
						elif accountName == 'googleplus':
							mySW.ui.googleText_2.setText(data)
						elif accountName == 'pinterest':
							mySW.ui.pinterestText_2.setText(data)
						elif accountName == 'facebook':
							mySW.ui.facebookText_2.setText(data)
						elif accountName == 'linkedin':
							mySW.ui.linkedinText_2.setText(data)


'''
GET FOLLOWERS AREA LISTENERS
'''
def listenerFetchButton():
	print "fetch bt started ;D"

	tableView = mySW.ui.tableView
	model = QtGui.QStandardItemModel(6, 3, tableView)
	model.setHorizontalHeaderLabels(('Client Name' , 'Social Network', 'Accounts', 'Followers'))

	data = FileHelper().openReadOnlyJSONFileASObject('data.txt')

	i = 0
	for client in data['clients']:
		
		for account in client['accounts']:
			accountData = getFollowers.fetch_for_all_accounts(account)

			print accountData
			if accountData:
				itemClient = QtGui.QStandardItem(client['name'])
				itemNet = QtGui.QStandardItem(accountData[0])
				itemName = QtGui.QStandardItem(accountData[1])
				itemData = QtGui.QStandardItem(accountData[2])

				model.setItem(i, 0, itemClient)
				model.setItem(i, 1, itemNet)
				model.setItem(i, 2, itemName)
				model.setItem(i, 3, itemData)
				i = i+1


	tableView.setModel(model)
	'''
	tableView.setColumnWidth(0, 170)
	tableView.setColumnWidth(1, 160)
	tableView.setColumnWidth(2, 160)
	tableView.setColumnWidth(3, 167)
	'''
	
	for k in range(0,i):
		tableView.resizeRowToContents(k)

	
   	

def loadClientList():

	data = FileHelper().openReadOnlyJSONFileASObject('data.txt')
	clientList = mySW.ui.clientListWidget

	for i in range(0,clientList.count()):
		
		p = clientList.takeItem(0)

	for client in data['clients']:
		mySW.ui.clientListWidget.addItem(client['name'])

def configureDicctionaries():
	global dicCk
	dicCk = {
		'twitter' : mySW.ui.twitterCk,
		'googleplus' : mySW.ui.googleCk,
		'facebook' : mySW.ui.facebookCk,
		'pinterest' : mySW.ui.pinterestCk,
		'youtube' : mySW.ui.youtubeCk,
		'linkedin' : mySW.ui.linkedinCk
	}

	global dicLt
	dicLt = {
		'twitter' : mySW.ui.twitterText_2,
		'googleplus' : mySW.ui.googleText_2,
		'facebook' : mySW.ui.facebookText_2,
		'pinterest' : mySW.ui.pinterestText_2,
		'youtube' : mySW.ui.youtubeText_2,
		'linkedin' : mySW.ui.linkedinText_2
	}

def listenerActionExit():
	sys.exit(0)

def listenerDeleteClientButton():
	currentItem = mySW.ui.clientListWidget.currentItem()
	if currentItem:
		accountManager.delete_client(currentItem.text())
		mySW.ui.clientListWidget.takeItem(mySW.ui.clientListWidget.currentRow())	

def addClientListener():
        """
        Opens the text version of the input dialog
        """
        text, result = QtGui.QInputDialog.getText(mySW, "Adding new Client",
                                            "Insert the name of your new Client")
        if result:
        	accounts = [ 'pinterest:'+"", 'googleplus:'+"" , 'facebook:'+"", 'linkedin:'+"", 'youtube:'+"", 'twitter:'+"" ]
         	accountManager.create_account_group(text,accounts,False)
        	loadClientList()

def listenerActionAboutSM():
	aboutmsg = "Program for getting Followers in Social Networks\n"
	aboutmsg = aboutmsg +"The Program is given AS IS, dont blame the dev if it doesn't work\n"
	aboutmsg = aboutmsg +"If you're not agree , close this immediately\n"
	aboutmsg = aboutmsg +"Proudly made for BSoD Software , special greetings to JLPV and DST"

	QtGui.QMessageBox.information(mySW, "About SM", aboutmsg)

def listenerActionAboutBSOD():
	
	QtGui.QMessageBox.information(mySW, "About BSoD Software", "Placeholder")

class ControlMainWindow(QtGui.QMainWindow):
	def __init__(self, parent=None):
		super(ControlMainWindow, self).__init__(parent)
		self.ui = Ui_MainWindow()
		self.ui.setupUi(self)

	def customSetUp(self):

		configureDicctionaries()
		loadClientList()

		#Listener for Client name text field
		#self.ui.clientNameText.textEdited.connect(listenerClientName)
		#Listener for save client and accounts button
		#self.ui.saveBt.clicked.connect(listenerSaveButton)
		self.ui.addClientButton.clicked.connect(addClientListener)
		#Listeners for checkboxes
		self.ui.linkedinCk.clicked.connect(listenerCheckBoxes)
		self.ui.twitterCk.clicked.connect(listenerCheckBoxes)
		self.ui.facebookCk.clicked.connect(listenerCheckBoxes)
		self.ui.youtubeCk.clicked.connect(listenerCheckBoxes)
		self.ui.pinterestCk.clicked.connect(listenerCheckBoxes)
		self.ui.googleCk.clicked.connect(listenerCheckBoxes)
		#Listener for remove social account
		self.ui.removeBt.clicked.connect(listenerRemoveAccounts)
		#Listener for edit social info accounts
		self.ui.editBt.clicked.connect(listenerEditInfo)
		#Listener client list
		self.ui.clientListWidget.itemClicked.connect(listenerOnClientClicked)
		#LIstener fetch button
		self.ui.fetchBt.clicked.connect(listenerFetchButton)

		self.ui.deleteClientButton.clicked.connect(listenerDeleteClientButton)
		
		QtCore.QObject.connect(self.ui.actionExit, QtCore.SIGNAL('triggered()'), listenerActionExit)

		QtCore.QObject.connect(self.ui.actionAboutSM, QtCore.SIGNAL('triggered()'), listenerActionAboutSM)
		QtCore.QObject.connect(self.ui.actionaboutBSOD, QtCore.SIGNAL('triggered()'), listenerActionAboutBSOD)
		


if __name__ == '__main__':
	app = QtGui.QApplication(sys.argv)
	mySW = ControlMainWindow()
	mySW.customSetUp()
	mySW.show()
	sys.exit(app.exec_())